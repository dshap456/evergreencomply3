"use client";import{useState as D}from"react";import{default as b}from"js-cookie";import{createContext as k,useCallback as d,useContext as w}from"react";var v=["url","method","baseURL","headers","params","data","timeout","timeoutErrorMessage","withCredentials","auth","responseType","proxy","decompress"];function x(e){var o,i,r,m,c,n;let s=v.reduce((a,u)=>({...a,[u]:e.config[u]}),{}),t={data:(o=e.response)==null?void 0:o.data,status:(i=e.response)==null?void 0:i.status,statusText:(r=e.response)==null?void 0:r.statusText,headers:(m=e.response)==null?void 0:m.headers};return{config:s,response:t,code:e.code,stack:e.stack,name:e.name,message:e.message||`Request failed${(c=e.response)!=null&&c.status?` with status code ${(n=e.response)==null?void 0:n.status}`:""}`,isAxiosError:!0}}function R(e){return e!=null&&e.isAxiosError?x(e):{name:e.name,message:e.message,stack:e.stack}}var p=k({});function l(){let{config:e,setConfig:s,queue:t}=w(p),o=!e||!t,i=d(n=>{if(!o)return s(a=>({...a,userId:n}))},[o]),r=d((n,a={})=>{if(o)return;let u={level:(a==null?void 0:a.level)||"info",message:n,...a};t.push(u,e)},[o,e]),m=d((n,a)=>{if(o)return;if(a){let C=a.componentStack.split("@")[0],I={level:"error",data:{error:n},stack:a.componentStack,error:{message:n.message,name:n.name,cause:n.cause},causedBy:C,message:`${n.name}: ${n.message}`};return t.push(I,e)}let u=R(n),y={level:"error",data:{error:n},stack:a==null?void 0:a.componentStack,error:{...u},message:`${n.name}: ${n.message}`};t.push(y,e)},[o,e]),c=d(n=>{if(o)return;let a={...n,data:n.entries[0],entries:void 0};t.push(a,e)},[o,e]);return o&&console.warn("Using useBaselimeRum outside of BaselimeRum context, operations will be no-ops"),{config:e,setUser:i,captureException:m,sendEvent:r,_trackWebVital:c}}import{useEffect as A}from"react";import{onCLS as S,onFCP as q,onFID as F,onINP as P,onLCP as L,onTTFB as T}from"web-vitals";function B(e){let{config:s,_trackWebVital:t,sendEvent:o}=l();return A(()=>{if(!s.enableLocal&&typeof window<"u"&&window.location.hostname==="localhost")return;s.enableWebVitals&&(S(t),q(t),P(t),L(t),T(t),F(t));function i(r){r({data:{timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,lanuage:navigator.language,os:navigator.oscpu||navigator.platform,userAgent:navigator.userAgent,url:window.location.href},hostname:window.location.hostname,path:window.location.pathname})}i(r=>o("Page View",r))},[]),e.children}var f=class{queue;queueSize;duration;timeout=null;constructor(){this.queue=[]}push(s,t){if(this.queue.push(s),this.queue.length>=this.queueSize)return this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.flush(t);this.timeout||(this.timeout=setTimeout(()=>{this.flush(t),this.timeout=null},this.duration))}async flush(s){if(this.queue.length===0)return;let t=this.queue;this.queue=[],await fetch(`${s.url||"https://events.baselime.io/v1"}/${s.dataset||"web"}`,{method:"POST",headers:{contentType:"application/json","x-api-key":s.apiKey,"user-agent":"@baselime/react-rum/0.1.5",library:"@baselime/react-rum/0.1.5","x-service":s.service||window.location.hostname,"x-namespace":s.namespace||window.location.pathname},body:JSON.stringify(t.map(o=>({userId:s.userId,sessionId:s.sessionId,pageLoadId:s.pageLoadId,namespace:s.namespace||window.location.pathname,...o})))})}};import{ErrorBoundary as V}from"react-error-boundary";import{jsx as W}from"react/jsx-runtime";function g(e){let{captureException:s}=l();function t(o,i){var r;try{s(o,i)}catch{}(r=e.onError)==null||r.call(e,o,i)}return W(V,{...e,onError:t,children:e.children})}function h(){try{return crypto.randomUUID()}catch{return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}}import{jsx as E}from"react/jsx-runtime";var U=new f;function Ee(e){b.get("baselime-session-id")||b.set("baselime-session-id",h());let t={userId:e.userId,sessionId:b.get("baselime-session-id"),pageLoadId:h(),namespace:e.namespace,apiKey:e.apiKey,dataset:e.dataset||"web",service:e.service,url:e.url||"https://events.baselime.io/v1",enableLocal:e.enableLocal||!1,enableWebVitals:e.enableWebVitals||!1},[o,i]=D(t);return E(p.Provider,{value:{config:o,setConfig:i,queue:U},children:E(g,{fallback:e.fallback,fallbackRender:e.fallbackRender,children:E(B,{children:e.children})})})}export{g as BaselimeErrorBoundary,Ee as BaselimeRum,l as useBaselimeRum};
